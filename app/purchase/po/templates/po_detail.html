{% extends 'base.html' %}
{% block content %}
    <h3>Purchase Order {{ po[0] }} Details</h3>
    <table>
        <tr>
            <th>ID</th>
            <th>Created Date</th>
            <th>Purchase Date</th>
            <th>Status</th>
            <th>Supplier</th>
        </tr>
        <tr>
            <td>{{ po[0] }}</td>
            <td>{{ po[1].strftime('%Y-%m-%d %H:%M') if po[1] else '' }}</td>
            <td>{{ po[2].strftime('%Y-%m-%d %H:%M') if po[2] else '' }}</td>
            <td>{{ po[3] }}</td>
            <td><a href="/purchase/suppliers/{{ po[4] }}">{{ po[4] }}</a></td>
        </tr>
    </table>
    <h3>PO Lines:</h3>
    <table>
        <tr>
            <th>ID</th>
            <th>Purchase Order ID</th>
            <th>Product</th>
            <th>Quantity</th>
            <th>Unit Price</th>
            <th>Cost</th>
        </tr>
        {% for po_line in po_lines %}
        <tr>
            <td>{{ po_line[0] }}</td>
            <td><a href="/manufacturing/products/{{ po_line[2] }}">{{ po_line[3] }}</a></td>
            <td>{{ po_line[4] }}</td>
            <td>{{ po_line[5] }}</td>
            <td>{{ po_line[5] * po_line[4] }}</td>
        </tr>
        {% endfor %}
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td><strong>Total: {{ total }}</strong></td>
        </tr>
    </table>

    <h3>Add PO Line</h3>
    <form method="POST" action="{{ url_for('po.add_po_line', id=po[0]) }}">
        <div class="form-group">
            <label for="product">Product:</label>
            <select class="form-control" id="product" name="product_id">
                {% for product in products %}
                    <option value="{{ product[0] }}">{{ product[1] }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="quantity">Quantity:</label>
            <input type="number" class="form-control" id="quantity" name="quantity">
        </div>
        <button type="submit" class="btn btn-primary">Add</button>
    </form>

    {% if po[3] == 'Draft' %}
        <h3>Progress Status:</h3>
        <form method="POST" action="{{ url_for('po.set_status', id=po[0]) }}">
            <button type="submit" class="btn btn-primary" name="status" value="Pending Approval">Request Approval</button>
        </form>
    {% endif %}

    {% if po[3] == 'Pending Approval' %}
        <h3>Set Status:</h3>
        <form method="POST" action="{{ url_for('po.set_status', id=po[0]) }}">
            <button type="submit" class="btn btn-primary" name="status" value="Approved">Approved</button>
            <button type="submit" class="btn btn-primary" name="status" value="Cancelled">Cancel</button>
        </form>
    {% endif %}

    {% if po[3] == 'Approved' %}
        <h3>Set Status:</h3>
        <form method="POST" action="{{ url_for('po.set_status', id=po[0]) }}">
            <button type="submit" class="btn btn-primary" name="status" value="In Progress">In Progress</button>
            <button type="submit" class="btn btn-primary" name="status" value="Completed">Completed</button>
            <button type="submit" class="btn btn-primary" name="status" value="Cancelled">Cancel</button>
        </form>
    {% endif %}

    {% if po[3] == 'In Progress' %}
        <h3>Set Status:</h3>
        <form method="POST" action="{{ url_for('po.set_status', id=po[0]) }}">
            <button type="submit" class="btn btn-primary" name="status" value="Completed">Completed</button>
            <button type="submit" class="btn btn-primary" name="status" value="Cancelled">Cancel</button>
        </form>
    {% endif %}

    {% if po[3] == 'Cancelled' %}
        <h3>Set Status:</h3>
        <form method="POST" action="{{ url_for('po.set_status', id=po[0]) }}">
            <button type="submit" class="btn btn-primary" name="status" value="Draft">Draft</button>
        </form>
    {% endif %}

{% endblock %}
